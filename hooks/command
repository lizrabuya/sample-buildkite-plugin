#!/bin/bash

set -euo pipefail

DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# shellcheck source=lib/shared.bash
. "$DIR/../lib/shared.bash"

# shellcheck source=lib/plugin.bash
. "$DIR/../lib/plugin.bash"

# Global variable used by plugin_read_list_into_result
result=()

# Optional: Load feature modules for complex plugins
# shellcheck source=lib/modules/example.bash
# . "$DIR/../lib/modules/example.bash"

# Usage: validate_timeout (ensures timeout is within acceptable range)
validate_timeout() {
  local timeout_option
  timeout_option=$(plugin_read_config TIMEOUT "")
  if [ -n "${timeout_option}" ]; then
    if [[ "$timeout_option" -lt 1 || "$timeout_option" -gt 60 ]]; then
      log_error "timeout must be between 1 and 60 seconds"
      exit 1
    fi
  fi
}

main() {
  # Set up error reporting and debug mode
  setup_error_trap
  enable_debug_if_requested

  # Get configuration
  local optional_option
  optional_option=$(plugin_read_config OPTIONAL "default")

  # Validate configuration
  validate_timeout

  echo "--- :hammer: Running plugin"

  log_info "Running plugin with options:"
  log_info "optional: ${optional_option}"
     
  # Your main plugin logic here
  log_success "Plugin executed successfully"
}

main "$@"
