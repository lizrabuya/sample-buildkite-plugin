#!/usr/bin/env bash

set -euo pipefail

# Load plugin library
# shellcheck source=lib/plugin.bash
source "$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)/../lib/plugin.bash"

# Main Execution
log_section ":house_with_garden: Plugin setting up post-checkout tasks"
log_info "Checking out pre-checkout tasks"
if [ "${PLUGIN_PRE_CHECKOUT_RAN:-false}" = "true" ]; then
  log_info "Pre-checkout tasks were run"
else
  log_warning "Pre-checkout tasks were not run"
fi

# Create a log file to demonstrate post-checkout actions
LOG_FILE=${PLUGIN_LOGFILE:-"post_checkout_logfile.txt"}
TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')

# Create the log line
LOG_LINE="[$TIMESTAMP] post checkout scripts is executed successfully"
# Write the log line to the file
echo "$LOG_LINE" > "$LOG_FILE"
# Confirm to user the log file created with complete path
echo "Post-checkout log created at $(pwd)/$LOG_FILE"
echo "Log entry: $LOG_LINE"


export PLUGIN_POST_CHECKOUT_RAN="true"
log_success "Plugin executed successfully"